# SMTP Coding Style

## 空格
### 一元运算符： 无空格
  *, &, [], ++, --, 等等
### 二元运算符： 两侧各一个空格
  +, -, *, /, =, %, 等等
### ()周围的空格
 - 函数调用不加空格： set_value(1);
 - 内沿不加空格: set_value(a, b);
 - 接在if, if else, else, while, for 后面加空格: if (a > 0)
 - 后面有{时，加空格： if (a > 0) {
### 逗号, 后一个空格

## 空行
### 函数定义之间一个空行
### 函数内段落之间一个空行
段落： 
- 前处理：准备
- 执行
- 后处理：返回值检查，保留结果，清理
    
## 缩进与对齐
缩进基本原则：入乡随俗
- 优先Tab缩进
- 4空格

## 对齐
 - 正常情况下，连续多个变量赋值时，不对齐变量名，不对齐 =
 - 在需要用户修改时，需要对齐，应该放入makefile和script
    
## 函数命名
### 基本原则： 入乡随俗，字母开头
  - 全小写, 下划线
  - 驼峰
  - 首字母小写，驼峰
### 自研库函数命名
  - C： 全小写, _
  - C++: 驼峰
  
## 变量命名
- 常用缩写尽量使用
  ret, err, tmp, i, i, k, val, ptr, addr, buff, min, max. diff
- 名字来自协议
  增加注释标明：文档名，章节，协议中名称
- 不带类型前缀

## 头文件
- 文件注释：用途，协议来源，Copyright
- 防重复，宏格式: 模块名全大写加下划线，两侧双下划线
- C++ 头 extern "C"
- 宏定义
- 外部结构体定义
- 回调函数声明
- 函数声明

## C文件
- 文件头注释：用途，协议来源，Copyright
- include <> 系统头文件
- include 平台头文件
- include 所处大模块头文件
- include 本模块声明头文件
- LOG/DEBUG 宏开关
- 其他宏定义
- 内部函数声明，使用static描述符，尽量利用函数定义的顺序避免函数声明
- 全局变量定义，使用static描述符，不使用函数内部static

## 宏
- 命名全大写和下划线
- 使用()避免预编译展开错误
- 换行末尾使用\,注意\后必须直接换行
- 如果宏内容有多条语句使用 do...while(0)封装

## 结构体
- 保留struct
- typedef 用于内部结构体以指针方式暴露
- 赋值使用 .member = 123,
- 使用位域时，需要补充单元测试prinf验证

## 回调函数
- 使用typedef 声明
- 调用直接接括号, 不用*取值: callback();

## 指针
### 指针声明 
  - 靠右紧贴变量，左侧与类型之间一个空格: int *buff; 
  - 右侧原则，熟悉掌握默认的意义，不随意加(): int *arr[] 是数组， int (*p)[] 是指针
### 与const的配合
  - 最常见用法，用于函数参数声明，表示输入的数据，内容不可修改: const char *input
  - 不使用 char const *input; 
  - char * const input 意义完全不同。用于函数过于冗长时，应重构函数
  
 ## 函数
 - 函数定义的 {} 要换行
 - 如果参数是指针，入参用 const修饰，出参无const修饰
 - 参数是数组，改用指针声明
 - 正常函数长度不超过一屏（20 行）
 - 正常函数不可循环嵌套，特殊情况最多两层
 
 ## 注释
 - 原则：尽量用命名和代码逻辑表达含义，注释是辅助理解。优秀的代码，是以不需要看注释为前提。
 - 善用TODO注释，防止漏写
 - C注释使用/* */
 - [TYM] 头可用于标识出对一些极少修改的库文件的修改
 
 ## 循环语句 for与while
 - for常用于正常的遍历数据，遍历链表
 - for可用i, j, k， 循环的执行内容比较规规矩矩，特殊情况和特殊处理少
 - while用于比较复杂的情况，如果处理字节流，需要判断外部条件
 - while(1) 表示一个死循环，常用于一个线程; 非死循环情况在非必要情况下不使用
 - 不用do...while, 除了前面宏定义中使用
 
 ## if 语句
 - if 如果函数体只有一句时不加 {}
 - if与()之间一个空格， ）与 {之间一个空格， {不换行
 - 如果有 else if () {}, 要加else {}
 
 ## switch 格式要注意
 ```
 switch (x) {
 case 1:
  do_something();
  break;
 case 2:
  do_something();
  break;
 default:
  break;
 }
 ```
 
 
